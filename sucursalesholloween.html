<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sucursales Celucenter ‚Äî Ofertas de Miedo üéÉüíÄ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{--bg-0:#0b0b11; --bg-1:#101018; --card:#141422; --ink:#e6e6f2; --muted:#b8b8d6;
      --orange:#ff6a00; --orange-2:#ff9a2e; --violet:#7a3cff; --violet-2:#a78bfa;
      --glow: 0 0 16px rgba(255,106,0,.35), 0 0 32px rgba(122,60,255,.25);
      --radius:16px; --shadow: 0 8px 28px rgba(0,0,0,.45); --stroke: rgba(255,106,0,.2);
      --good:#38d39f;}html,body{height:100%}body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(122,60,255,.15), transparent 60%),
        radial-gradient(900px 500px at 100% 0%, rgba(255,106,0,.12), transparent 60%),
        linear-gradient(180deg, var(--bg-0), var(--bg-1));
      position: relative; overflow-x: hidden;}header{position: relative; padding: 32px 16px 18px; text-align:center;
      background: radial-gradient(800px 200px at 50% 0, rgba(255,106,0,.15), transparent 60%);
      border-bottom: 1px solid var(--stroke); box-shadow: inset 0 -1px 0 rgba(255,255,255,.03);}h1{margin:0 0 6px; font-size: clamp(24px, 3.6vw, 40px); letter-spacing:.5px;
      text-shadow: 0 1px 0 rgba(0,0,0,.6), 0 0 18px rgba(255,106,0,.35);}.subtitle{margin:0 0 14px; color: var(--muted); font-size: clamp(13px, 1.8vw, 15px);}header::before, header::after{content:""; position:absolute; top:0; width:220px; height:220px; opacity:.22; pointer-events:none;
      background-size:contain; background-repeat:no-repeat; filter: drop-shadow(0 2px 0 rgba(0,0,0,.5));}header::before{left:0; background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g stroke="%23ff6a00" stroke-opacity="0.6" fill="none"><path d="M0,0 L200,0"/><path d="M0,0 L0,200"/><path d="M0,0 C60,0 120,40 200,0"/><path d="M0,0 C0,60 40,120 0,200"/></g></svg>');}header::after{right:0; transform: scaleX(-1);
      background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g stroke="%237a3cff" stroke-opacity="0.6" fill="none"><path d="M0,0 L200,0"/><path d="M0,0 L0,200"/><path d="M0,0 C60,0 120,40 200,0"/><path d="M0,0 C0,60 40,120 0,200"/></g></svg>');}.bats{position:absolute; inset:0; pointer-events:none; overflow:hidden;}.bat{position:absolute; top:10px; left:-10%; width:28px; height:14px; opacity:.5; transform: scale(.9);
      background-image:url('data:image/svg+xml;utf8,<svg width="60" height="30" viewBox="0 0 60 30" xmlns="http://www.w3.org/2000/svg"><path d="M5,20 C10,10 20,5 30,10 C40,5 50,10 55,20 C50,18 45,18 40,22 C35,18 25,18 20,22 C15,18 10,18 5,20 Z" fill="%23e6e6f2"/></svg>');
      background-size:cover; animation: fly 12s linear infinite;}.bat:nth-child(2){top:40px; animation-duration: 14s; animation-delay: -2s; opacity:.35; transform: scale(.7);}.bat:nth-child(3){top:70px; animation-duration: 16s; animation-delay: -4s; opacity:.4; transform: scale(1.1);}@keyframes fly{0%{transform: translateX(0) translateY(0) scale(var(--s,1)); left:-10%;}50%{transform: translateX(50vw) translateY(-6px) scale(var(--s,1));}100%{transform: translateX(110vw) translateY(2px) scale(var(--s,1)); left:110%;}}@media (prefers-reduced-motion: reduce){.bat{display:none;}}.countdowns{display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      max-width: 1000px; margin: 8px auto 0; padding: 0 12px 14px;}.cd-card{background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08); border-radius: 14px; padding: 10px 12px;
      box-shadow: var(--shadow); display:flex; align-items:center; justify-content:space-between; gap:10px;}.cd-title{display:flex; align-items:center; gap:10px; font-weight:700;}.cd-title .badge{padding:4px 8px; border-radius:999px; font-size:12px; letter-spacing:.3px;
      border:1px solid rgba(255,255,255,.15); box-shadow: var(--glow);}.cd-title .halloween{color: var(--orange-2); border-color: rgba(255,106,0,.35);}.cd-title .muertos{color: var(--violet-2); border-color: rgba(122,60,255,.45);}.cd-timer{font-variant-numeric: tabular-nums; font-weight:700; text-shadow: 0 0 10px rgba(122,60,255,.25);}.cd-note{grid-column: 1 / -1; text-align:center; color: var(--muted); font-size: 12px; margin-top: -2px;}.cd-today{color: var(--good); text-shadow: 0 0 10px rgba(56,211,159,.35);}.grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 18px; padding: 24px; max-width: 1200px; margin: 0 auto 64px;}.card{position:relative; overflow:hidden; border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.06); box-shadow: var(--shadow);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease; will-change: transform; isolation:isolate;}.card::before{content:""; position:absolute; inset:0 0 auto 0; height: 18px; z-index:1; opacity:.9;
      background:
        radial-gradient(8px 6px at 12% 60%, var(--orange) 35%, transparent 40%) repeat-x,
        radial-gradient(10px 7px at 32% 60%, var(--orange-2) 35%, transparent 40%) repeat-x,
        linear-gradient(0deg, var(--orange), var(--orange-2));
      background-size: 22px 12px, 26px 14px, auto; background-position: 0 8px, 0 6px, 0 0;
      mix-blend-mode: screen; filter: drop-shadow(0 2px 4px rgba(0,0,0,.35));}.card:hover{transform: translateY(-4px); border-color: rgba(255,106,0,.35);
      box-shadow: 0 16px 46px rgba(255,106,0,.2), var(--shadow);}.card a{display:block; position:relative;}.card img{width:100%; height:220px; object-fit:contain; display:block;
      transition: opacity .3s ease, transform .3s ease;
      background: radial-gradient(120px 60px at 50% 45%, rgba(122,60,255,.12), transparent 60%);
      opacity: 0;}.card:hover img{transform: scale(1.02);}.card img.is-loaded{opacity:1;}.info{padding: 14px 14px 18px;}.nombre{font-weight: 700; font-size: 18px; margin-bottom: 6px; text-shadow: 0 0 10px rgba(122,60,255,.25);}.direccion,.telefono{font-size:14px; color: var(--muted); margin: 4px 0;}.link-maps{display:inline-block; margin-top:10px; font-size:14px; text-decoration:none;
      color: var(--orange-2); border:1px solid rgba(255,106,0,.35);
      padding:8px 10px; border-radius: 999px; box-shadow: var(--glow);
      transition: background .2s ease, box-shadow .2s ease, transform .2s ease;}.link-maps:hover{background: rgba(255,106,0,.08);
      box-shadow: 0 0 18px rgba(255,106,0,.55), 0 0 26px rgba(122,60,255,.35);
      transform: translateY(-1px);}.skeleton{border-radius: var(--radius);
      background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.12), rgba(255,255,255,.06));
      background-size: 200% 100%; animation: shine 1.2s linear infinite;
      height: 280px; box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,.06);}@keyframes shine{0%{background-position: 200% 0;}100%{background-position: -200% 0;}}.error{max-width:900px; margin:24px auto; padding:14px 16px; border-radius: 12px;
      background: rgba(255,0,0,.06); border:1px solid rgba(255,0,0,.25); color:#ffdcdc;}a:focus-visible, button:focus-visible{outline: 2px solid var(--violet-2); outline-offset: 2px; border-radius: 8px;}</style>
</head>
<body>

  <header>
    <h1>üéÉ Sucursales Celucenter ‚Äî Ofertas de Miedo</h1>
    <p class="subtitle">Explora tu sucursal m√°s cercana‚Ä¶ si te atreves. üïØÔ∏è</p>

    <div class="countdowns" id="countdowns">
      <div class="cd-card" data-event="halloween">
        <div class="cd-title">
          <span class="badge halloween">Halloween</span><span>31 de octubre</span>
        </div>
        <div class="cd-timer" id="timer-halloween">--d --:--:--</div>
      </div>
      <div class="cd-card" data-event="muertos">
        <div class="cd-title">
          <span class="badge muertos">D√≠a de Muertos</span><span>2 de noviembre</span>
        </div>
        <div class="cd-timer" id="timer-muertos">--d --:--:--</div>
      </div>
      <div class="cd-note">Ambos d√≠as con <strong>descuentos especiales</strong> en tu sucursal.</div>
    </div>

    <div class="bats">
      <div class="bat"></div><div class="bat"></div><div class="bat"></div>
    </div>
  </header>

  <main class="grid" id="catalogo">
    <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
  </main>

  <!-- JS: usa data-skip-moving y BX.ready para Bitrix -->
  <script type="text/javascript" data-skip-moving="true">
    // ===== Countdown =====
    function nextOccurrence(month, day, hour=0, minute=0, second=0){const now = new Date();
      const year = now.getFullYear();
      const target = new Date(year, month, day, hour, minute, second);
      if (now > target) target.setFullYear(year + 1);
      return target;}function formatDelta(ms){if (ms <= 0) return '<span class="cd-today">¬°Hoy!</span>';
      const totalSec = Math.floor(ms/1000);
      const days = Math.floor(totalSec / 86400);
      const rem = totalSec % 86400;
      const h = String(Math.floor(rem/3600)).padStart(2,'0');
      const m = String(Math.floor((rem%3600)/60)).padStart(2,'0');
      const s = String(rem%60).padStart(2,'0');
      return `${days}d ${h}:${m}:${s}`;}function startCountdown(el, getTargetDate){function tick(){const target = getTargetDate();
        const now = new Date();
        el.innerHTML = formatDelta(target - now);}tick();
      return setInterval(tick, 1000);}// ===== Carga im√°genes con fade =====
    function loadImage(imgEl, src){return new Promise((resolve) =>{const img = new Image();
        img.onload = () =>{imgEl.src = src; imgEl.classList.add('is-loaded'); resolve(true);};
        img.onerror = () => resolve(false);
        img.src = src;});}function renderCard({item, imagenes, index}){const idCarrusel = `carrusel-${index}`;
      const html = `
        <div class="card" aria-label="Sucursal ${item['Nombre de Sucursal']|| ''}">
          <a href="https://celucentershop.bitrix24.site/detallesucursal/?sucursal=${encodeURIComponent(item['Nombre de Sucursal']|| '')}" aria-label="Ver detalles de ${item['Nombre de Sucursal']|| 'sucursal'}">
            <img id="${idCarrusel}" alt="${(item['Nombre de Sucursal']|| 'Sucursal').replace(/"/g,'"')}" loading="lazy" />
          </a>
          <div class="info">
            <div class="nombre">${item['Nombre de Sucursal']|| ''}</div>
            <div class="direccion">${item['Direcci√≥n']|| ''}</div>
            <a class="link-maps" href="${item['Link de Ubicaci√≥n en Maps']|| '#'}" target="_blank" rel="noopener">üó∫Ô∏è Ver en Google Maps</a>
          </div>
        </div>
      `;
      return{html, idCarrusel};}// Ejecutar cuando Bitrix tenga el DOM listo (y no mueva el script)
    (window.BX ? BX.ready : (fn => document.addEventListener('DOMContentLoaded', fn)))(async function(){// Iniciar countdowns
      const hEl = document.getElementById('timer-halloween');
      const mEl = document.getElementById('timer-muertos');
      if (hEl) startCountdown(hEl, () => nextOccurrence(9,31, 0,0,0)); // Oct=9
      if (mEl) startCountdown(mEl, () => nextOccurrence(10,2, 0,0,0)); // Nov=10

      // Cargar sucursales
      const container = document.getElementById("catalogo");
      try{const resp = await fetch("https://opensheet.elk.sh/1La-5XY4i9Ng3zpiXrre5tyAqANxpb9yuZeS8muFiZXA/Lista%20CC",{cache: "no-store"});
        const data = await resp.json();
        container.innerHTML = "";

        data.forEach((item, index) =>{let imagenes =[];
          if (item['Archivo']&& item['Archivo'].trim() !== ""){imagenes = item['Archivo'].split(',').map(n => `https://raw.githubusercontent.com/piztian/SucursalesCelucenter/main/fotos/${n.trim()}`);}else if (item['URL']){imagenes =[item['URL']];}if (!imagenes.length) return;

          const{html, idCarrusel}= renderCard({item, imagenes, index});
          container.insertAdjacentHTML("beforeend", html);

          const imgEl = document.getElementById(idCarrusel);
          if (!imgEl) return;

          loadImage(imgEl, imagenes[0]);

          if (imagenes.length > 1){let i = 0;
            const rotate = async () =>{i = (i + 1) % imagenes.length;
              imgEl.style.opacity = 0;
              setTimeout(async () =>{await loadImage(imgEl, imagenes[i]);
                imgEl.style.opacity = 1;}, 220);};
            const interval = setInterval(rotate, 3000);
            document.addEventListener('visibilitychange', () =>{if (document.hidden) clearInterval(interval);},{once:true});}});

        if (!container.children.length){container.innerHTML = `<div class="error">No se encontraron sucursales con im√°genes disponibles.</div>`;}}catch(e){container.innerHTML = `<div class="error">üëª Ups‚Ä¶ no pudimos cargar la lista. Intenta de nuevo m√°s tarde.</div>`;
        console.error("Error cargando sucursales:", e);}});
  </script>
</body>
</html>
